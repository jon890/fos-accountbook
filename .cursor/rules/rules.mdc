---
alwaysApply: true
---

# ìš°ë¦¬ì§‘ ê°€ê³„ë¶€ - Cursor AI ê°œë°œ ê·œì¹™

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”
Next.js 15 + TypeScript + Prisma ORM + Tailwind CSSë¥¼ ì‚¬ìš©í•œ ê°€ì¡± ê°€ê³„ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜

## ğŸ“‹ ì½”ë”© ì»¨ë²¤ì…˜

### 1. ë°ì´í„°ë² ì´ìŠ¤ & API ì»¨ë²¤ì…˜
- **ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ëª…ê³¼ ì»¬ëŸ¼ëª…ì€ snake_case ì‚¬ìš©**
  - ì˜ˆ: `family_members`, `created_at`, `user_id`, `family_uuid`
- **UUID ê¸°ë°˜ ê´€ê³„ ì„¤ì •**: ëª¨ë“  í…Œì´ë¸” ê°„ ì¡°ì¸ì€ UUIDë¥¼ í†µí•´ ìˆ˜í–‰
  - ì˜ˆ: `family_uuid`, `category_uuid` ë“±
- **Soft Delete íŒ¨í„´**: ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ í…Œì´ë¸”ì— `deleted_at` ì»¬ëŸ¼ ì‚¬ìš©

### 2. TypeScript íƒ€ì… ì•ˆì „ì„±
- **ì ˆëŒ€ `any` íƒ€ì… ì‚¬ìš© ê¸ˆì§€** - `unknown` ë˜ëŠ” ì •í™•í•œ íƒ€ì… ì‚¬ìš©
- **Prisma ê³µì‹ ì—ëŸ¬ íƒ€ì… ì‚¬ìš©**: `PrismaClientKnownRequestError` ë“±
- **Zod ìŠ¤í‚¤ë§ˆ ê²€ì¦**: `error.issues` ì‚¬ìš© (not `error.errors`)

### 3. ì•„í‚¤í…ì²˜ íŒ¨í„´
- **Repository íŒ¨í„´**: ë°ì´í„° ì•¡ì„¸ìŠ¤ ë ˆì´ì–´ ë¶„ë¦¬
- **Service íŒ¨í„´**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìº¡ìŠí™”
- **ì˜ì¡´ì„± ì£¼ì…**: Containerë¥¼ í†µí•œ ì¸ìŠ¤í„´ìŠ¤ ê´€ë¦¬

### 4. Next.js 15 ì•„í‚¤í…ì²˜ íŒ¨í„´ (ì¤‘ìš”!)
- **Server Components ìš°ì„  ì‚¬ìš©**: ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ëŠ” Server Componentë¡œ ì‘ì„±
- **Server Actions ìš°ì„  ì‚¬ìš©**: ë°ì´í„° ë³€ê²½ ì‘ì—…ì€ Server Actions ì‚¬ìš©
- **API RoutesëŠ” ìµœì†Œí™”**: ë‹¤ìŒ ê²½ìš°ì—ë§Œ API Routes ì‚¬ìš©
  - ì™¸ë¶€ Webhook ì²˜ë¦¬
  - ì¨ë“œíŒŒí‹° API í†µí•©
  - NextAuth.js ë“± ë¼ì´ë¸ŒëŸ¬ë¦¬ ìš”êµ¬ì‚¬í•­
  - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ë“± íŠ¹ìˆ˜í•œ ê²½ìš°
- **Client ComponentëŠ” í•„ìš”í•œ ê²½ìš°ë§Œ**: ë‹¤ìŒ ê²½ìš°ì—ë§Œ 'use client' ì‚¬ìš©
  - ì‚¬ìš©ì ìƒí˜¸ì‘ìš© (onClick, onChange ë“±)
  - React Hooks ì‚¬ìš© (useState, useEffect ë“±)
  - ë¸Œë¼ìš°ì € ì „ìš© API ì‚¬ìš©

### 5. í”„ë¡ íŠ¸ì—”ë“œ ì»¨ë²¤ì…˜
- **React 19 ê¸°ëŠ¥ ì‚¬ìš©**: ìµœì‹  React 19 API ë° ê¸°ëŠ¥ì„ ì ê·¹ í™œìš©
  - **âŒ `ReactDOM.useFormState` ì‚¬ìš© ê¸ˆì§€** (deprecated)
  - **âœ… `React.useActionState` ì‚¬ìš©** - React 19ì—ì„œ ê³µì‹ APIë¡œ ë³€ê²½
  - import ê²½ë¡œ: `react-dom` â†’ `react`
  ```typescript
  // âŒ ì˜ëª»ëœ ë°©ë²• (êµ¬ë²„ì „)
  import { useFormState } from 'react-dom'
  const [state, formAction] = useFormState(action, initialState)
  
  // âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (React 19)
  import { useActionState } from 'react'
  const [state, formAction] = useActionState(action, initialState)
  ```
- **React Hooks ìµœì í™”**: `useCallback`, `useMemo` ì ì ˆíˆ ì‚¬ìš©
- **Next.js Image ì»´í¬ë„ŒíŠ¸**: `<img>` íƒœê·¸ ëŒ€ì‹  `<Image />` ì‚¬ìš©
- **Tailwind CSS**: ì¼ê´€ëœ ìŠ¤íƒ€ì¼ë§
- **shadcn/ui**: UI ì»´í¬ë„ŒíŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ
- **Frontend**: Next.js 15, React 19, TypeScript, Tailwind CSS v3
- **Backend**: Next.js Server Actions, Prisma ORM
- **Database**: Supabase (PostgreSQL)
- **Authentication**: NextAuth.js (Google OAuth)
- **Deployment**: Vercel
- **Package Manager**: pnpm

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
src/
â”œâ”€â”€ app/                 # Next.js App Router
â”‚   â”œâ”€â”€ actions/        # Server Actions (ê¶Œì¥)
â”‚   â”œâ”€â”€ api/            # API Routes (ìµœì†Œí™”)
â”‚   â””â”€â”€ (pages)/        # Page Components
â”œâ”€â”€ components/         # React Components
â”‚   â”œâ”€â”€ ui/            # shadcn/ui Components
â”‚   â”œâ”€â”€ common/        # ê³µí†µ ì»´í¬ë„ŒíŠ¸
â”‚   â””â”€â”€ feature/       # ê¸°ëŠ¥ë³„ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ lib/               # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â”œâ”€â”€ repositories/      # ë°ì´í„° ì•¡ì„¸ìŠ¤ ë ˆì´ì–´
â”œâ”€â”€ services/          # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë ˆì´ì–´
â”œâ”€â”€ container/         # ì˜ì¡´ì„± ì£¼ì… ì»¨í…Œì´ë„ˆ
â””â”€â”€ types/            # TypeScript íƒ€ì… ì •ì˜
```

## ğŸš€ ê°œë°œ ê°€ì´ë“œë¼ì¸

### 1. ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ (ê¶Œì¥ íŒ¨í„´)
1. Repository ì¸í„°í˜ì´ìŠ¤ ì •ì˜
2. Repository êµ¬í˜„ì²´ ì‘ì„±
3. Service ë ˆì´ì–´ êµ¬í˜„
4. **Server Actions ì‘ì„±** (`src/app/actions/` ë””ë ‰í† ë¦¬)
5. Server Componentì—ì„œ Server Actions í˜¸ì¶œ
6. í•„ìš”í•œ ë¶€ë¶„ë§Œ Client Componentë¡œ ë¶„ë¦¬

**ì˜ˆì‹œ: Server Actions íŒ¨í„´**
```typescript
// src/app/actions/todo-actions.ts
'use server'

import { auth } from "@/lib/auth"
import { container } from "@/container"
import { revalidatePath } from "next/cache"

export async function createTodo(data: CreateTodoData) {
  const session = await auth()
  if (!session?.user?.id) throw new Error('Unauthorized')
  
  const todoService = container.getTodoService()
  const result = await todoService.create(data)
  
  revalidatePath('/todos')
  return result
}

// src/app/todos/page.tsx (Server Component)
import { getTodos } from '../actions/todo-actions'

export default async function TodosPage() {
  const todos = await getTodos()
  return <TodoList todos={todos} />
}
```

### 2. API Routeê°€ í•„ìš”í•œ ê²½ìš° (ì˜ˆì™¸)
1. Repository ì¸í„°í˜ì´ìŠ¤ ì •ì˜
2. Repository êµ¬í˜„ì²´ ì‘ì„±
3. Service ë ˆì´ì–´ êµ¬í˜„
4. API Route ì‘ì„± (`withAuth` ì‚¬ìš©)
5. ì—ëŸ¬ ì²˜ë¦¬ ë° íƒ€ì… ì•ˆì „ì„± í™•ë³´

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‹œ (ì¤‘ìš”!)
**âš ï¸ ë°˜ë“œì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë³€ê²½ ì´ë ¥ì„ ì¶”ì í•´ì•¼ í•©ë‹ˆë‹¤**

1. Prisma ìŠ¤í‚¤ë§ˆ ìˆ˜ì • (snake_case ì¤€ìˆ˜)
2. **ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš©** (í•„ìˆ˜)
   ```bash
   # ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš©
   pnpm db:migrate
   
   # ë˜ëŠ” ìƒì„±ë§Œ í•˜ê¸° (ê²€í†  í›„ ì ìš©)
   pnpm db:migrate:create
   ```
3. **âŒ `db:push` ì‚¬ìš© ê¸ˆì§€** - í”„ë¡œí† íƒ€ì´í•‘ ì‹œì—ë§Œ ì œí•œì  ì‚¬ìš©
   - ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ê°€ ë‚¨ì§€ ì•ŠìŒ
   - íŒ€ í˜‘ì—… ì‹œ ë¬¸ì œ ë°œìƒ ê°€ëŠ¥
   - í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ ì¶”ì  ë¶ˆê°€
4. Repository êµ¬í˜„ì²´ ì—…ë°ì´íŠ¸
5. íƒ€ì… ì •ì˜ í™•ì¸
6. ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì»¤ë°‹ (ë°˜ë“œì‹œ í¬í•¨)

### 4. ì»´í¬ë„ŒíŠ¸ ê°œë°œ ì‹œ
1. **ê¸°ë³¸ì€ Server Component**: 'use client' ì—†ì´ ì‹œì‘
2. ìƒí˜¸ì‘ìš©ì´ í•„ìš”í•œ ê²½ìš°ë§Œ Client Componentë¡œ ë¶„ë¦¬
3. TypeScript Props ì¸í„°í˜ì´ìŠ¤ ì •ì˜
4. React Hooks ì˜ì¡´ì„± ìµœì í™”
5. ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ê³ ë ¤
6. ì ‘ê·¼ì„± (a11y) ê³ ë ¤

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ë°ì´í„°ë² ì´ìŠ¤
- **âœ… ë°˜ë“œì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‚¬ìš©**: ëª¨ë“  ìŠ¤í‚¤ë§ˆ ë³€ê²½ì€ `pnpm db:migrate`ë¡œ ì²˜ë¦¬
- **âŒ `db:push` ê¸ˆì§€**: í”„ë¡œí† íƒ€ì´í•‘ ë‹¨ê³„ ì™¸ì—ëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
- **âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì»¤ë°‹**: `prisma/migrations/` ë””ë ‰í† ë¦¬ ì „ì²´ë¥¼ Gitì— í¬í•¨
- **âŒ Productionì—ì„œ `--force-reset` ì ˆëŒ€ ê¸ˆì§€**: ë°ì´í„° ì†ì‹¤ ìœ„í—˜
- **âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆœì„œ ìœ ì§€**: íŒ€ì›ê³¼ ë§ˆì´ê·¸ë ˆì´ì…˜ ì¶©ëŒ ì£¼ì˜

### ë³´ì•ˆ
- **í™˜ê²½ë³€ìˆ˜ (.env.local) ì»¤ë°‹ ê¸ˆì§€**
- **API í‚¤ ë° ë¯¼ê°í•œ ì •ë³´ ë…¸ì¶œ ê¸ˆì§€**
- **Server Actionsì—ì„œëŠ” í•­ìƒ ì¸ì¦ í™•ì¸ í•„ìˆ˜**

### ì½”ë“œ í’ˆì§ˆ
- **íƒ€ì… ì•ˆì „ì„±ì„ ìœ„í•´ ëŸ°íƒ€ì„ ê²€ì¦ í•„ìˆ˜**
- **any íƒ€ì… ì‚¬ìš© ê¸ˆì§€**: unknown ë˜ëŠ” ì •í™•í•œ íƒ€ì… ì‚¬ìš©

## ğŸ”§ ìœ ìš©í•œ ëª…ë ¹ì–´

### ê°œë°œ ì„œë²„
```bash
pnpm dev              # ê°œë°œ ì„œë²„ ì‹¤í–‰
pnpm build            # í”„ë¡œë•ì…˜ ë¹Œë“œ
```

### ë°ì´í„°ë² ì´ìŠ¤ (ì¤‘ìš”!)
```bash
# âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ (ê¶Œì¥ - ë³€ê²½ ì´ë ¥ ì¶”ì )
pnpm db:migrate              # ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„± ë° ì ìš©
pnpm db:migrate:create       # ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±ë§Œ (ê²€í†  í›„ ì ìš©)
pnpm db:migrate:deploy       # í”„ë¡œë•ì…˜ ë°°í¬ìš© ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©

# ğŸ“Š ê¸°íƒ€ ìœ í‹¸ë¦¬í‹°
pnpm db:studio               # Prisma Studio ì‹¤í–‰ (ë°ì´í„° ì‹œê°í™”)
pnpm db:generate             # Prisma Client ìƒì„±
pnpm db:validate             # ìŠ¤í‚¤ë§ˆ ê²€ì¦

# âš ï¸ í”„ë¡œí† íƒ€ì´í•‘ ì „ìš© (ì¼ë°˜ ê°œë°œì—ì„œëŠ” ì‚¬ìš© ê¸ˆì§€)
pnpm db:push                 # ë§ˆì´ê·¸ë ˆì´ì…˜ ì—†ì´ ìŠ¤í‚¤ë§ˆ ë™ê¸°í™”
                             # ì£¼ì˜: ë³€ê²½ ì´ë ¥ì´ ë‚¨ì§€ ì•ŠìŒ!
```

### ë°°í¬
```bash
vercel                # Vercel ë°°í¬
```

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ê·œì¹™

### í…Œì´ë¸” ë° ì»¬ëŸ¼ ëª…ëª… ê·œì¹™
- **í…Œì´ë¸”ëª…**: snake_case (ì˜ˆ: `family_members`, `verification_tokens`)
- **ì»¬ëŸ¼ëª…**: snake_case (ì˜ˆ: `user_id`, `created_at`, `family_uuid`)
- **ê´€ê³„ ì»¬ëŸ¼**: UUID ê¸°ë°˜ (ì˜ˆ: `family_uuid`, `category_uuid`)

### ìŠ¤í‚¤ë§ˆ ì˜ˆì‹œ
```prisma
model FamilyMember {
  id          BigInt    @id @default(autoincrement())
  uuid        String    @unique @default(uuid()) @db.Uuid
  family_uuid String    @db.Uuid @map("family_uuid")
  user_id     String    @map("user_id")
  role        String    @default("member")
  joined_at   DateTime  @default(now()) @map("joined_at")
  deleted_at  DateTime? @map("deleted_at")

  family Family @relation("FamilyMembers", fields: [family_uuid], references: [uuid])
  user   User   @relation("UserFamilyMembers", fields: [user_id], references: [id])

  @@unique([family_uuid, user_id])
  @@map("family_members")
}
```

## ğŸ”„ ìµœê·¼ ì£¼ìš” ê°œì„ ì‚¬í•­

### Next.js 15 Server Components & Server Actions ì „í™˜ (2025-09-30)
- **ë³€ê²½**: API Routes íŒ¨í„´ì—ì„œ Server Components + Server Actions íŒ¨í„´ìœ¼ë¡œ ì „í™˜
- **ì¥ì **:
  - Zero JavaScript by Default: Server ComponentsëŠ” í´ë¼ì´ì–¸íŠ¸ì— JSë¥¼ ë³´ë‚´ì§€ ì•ŠìŒ
  - ë” ë¹ ë¥¸ ì´ˆê¸° ë¡œë”©: ì„œë²„ì—ì„œ ë Œë”ë§ëœ ì½˜í…ì¸ 
  - í–¥ìƒëœ SEO: ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§
  - ì§ì ‘ì ì¸ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼: ì¤‘ê°„ API ë ˆì´ì–´ ë¶ˆí•„ìš”
  - ìë™ revalidation: `revalidatePath`ë¡œ ì‹¤ì‹œê°„ ë™ê¸°í™”
  - íƒ€ì… ì•ˆì „ì„±: ì „ì²´ ìŠ¤íƒì—ì„œ TypeScript íƒ€ì… ê³µìœ 

**ë°ì´í„° íë¦„**
```
ì‚¬ìš©ì ìš”ì²­
    â†“
Server Component (page.tsx)
    â†“
Server Action (actions/*.ts)
    â†“
Service Layer
    â†“
Repository Layer
    â†“
Prisma ORM â†’ Database
    â†“
HTML ë Œë”ë§ (ì„œë²„)
    â†“
í´ë¼ì´ì–¸íŠ¸ (ìµœì†Œ JavaScript)
```

### Repository ë ˆì´ì–´ ì•„í‚¤í…ì²˜ ê°œì„  (2025-12-21)
- **ë¬¸ì œ**: Repositoryì—ì„œ `serialize()` í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ Date ê°ì²´ê°€ ë¬¸ìì—´ë¡œ ë³€í™˜ë˜ì–´ ORM ì´ì  ìƒì‹¤
- **í•´ê²°**: 
  - Prismaê°€ ì œê³µí•˜ëŠ” Date ê°ì²´ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€
  - BigIntì™€ Decimalë§Œ í•„ìš” ì‹œ ë¬¸ìì—´ë¡œ ë³€í™˜
  - `date.toLocaleDateString is not a function` ì˜¤ë¥˜ í•´ê²°

### íƒ€ì… ì•ˆì „ì„± ê°œì„ 
```typescript
// âŒ ê¸°ì¡´: ì§ë ¬í™”ë¡œ ì¸í•œ íƒ€ì… í˜¼ë™
interface ExpenseData {
  date: Date | string  // ë¶ˆì•ˆì •í•œ ìœ ë‹ˆì˜¨ íƒ€ì…
  amount: string | number
}

// âœ… ê°œì„ : ORM ë ˆì´ì–´ì—ì„œ ëª…í™•í•œ íƒ€ì… ìœ ì§€
interface ExpenseData {
  date: Date           // Date ê°ì²´ ìœ ì§€
  amount: string       // Repositoryì—ì„œ ì¼ê´€ëœ ë¬¸ìì—´ ë³€í™˜
}
```

### ë°ì´í„° íë¦„ ìµœì í™”
```
Prisma ORM â†’ Repository â†’ Service â†’ Server Action â†’ UI
     â†“            â†“        â†“           â†“            â†“
   Date         Date    Date        Date         Date  âœ… Date ê°ì²´ ìœ ì§€
   Decimal   â†’ string  string      string       string âœ… ì¼ê´€ëœ ë³€í™˜
   BigInt    â†’ string  string      string       string âœ… ì¼ê´€ëœ ë³€í™˜
```

### í•µì‹¬ ì›ì¹™
1. **ORM ì´ì  í™œìš©**: Prismaì˜ íƒ€ì… ì•ˆì „ì„±ê³¼ Date ê°ì²´ë¥¼ ìµœëŒ€í•œ í™œìš©
2. **ìµœì†Œ ë³€í™˜**: ë°˜ë“œì‹œ í•„ìš”í•œ ê²½ìš°(BigInt, Decimal)ë§Œ ë¬¸ìì—´ë¡œ ë³€í™˜
3. **ì¼ê´€ëœ ì¸í„°í˜ì´ìŠ¤**: Repository ë ˆì´ì–´ì—ì„œ ì¼ê´€ëœ ë°ì´í„° í˜•íƒœ ì œê³µ
4. **Server Components ìš°ì„ **: ê¸°ë³¸ì ìœ¼ë¡œ Server Componentsì™€ Server Actions ì‚¬ìš©
5. **API Routes ìµœì†Œí™”**: ì™¸ë¶€ í†µí•©ì´ë‚˜ íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ë§Œ API Routes ì‚¬ìš©

### ì¤‘ìš” íŒŒì¼ë“¤
- `src/app/actions/dashboard-actions.ts`: ëŒ€ì‹œë³´ë“œ Server Actions
- `src/app/actions/expense-actions.ts`: ì§€ì¶œ Server Actions
- `src/repositories/implementations/expense.repository.impl.ts`: Date ê°ì²´ ìœ ì§€ ë¡œì§
- `src/repositories/interfaces/expense.repository.ts`: ì •í™•í•œ íƒ€ì… ì •ì˜
- `src/components/dashboard/RecentActivity.tsx`: Date ê°ì²´ ì§ì ‘ ì‚¬ìš©
- `src/lib/serialization.ts`: API ì‘ë‹µìš© ì§ë ¬í™” í•¨ìˆ˜ (Repositoryì—ì„œ ì‚¬ìš© ê¸ˆì§€)

ì´ëŸ¬í•œ ê°œì„ ì„ í†µí•´ Next.js 15ì˜ ìµœì‹  ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ì„œ ORMì˜ ì¥ì ì„ ì™„ì „íˆ í™œìš©í•˜ê³  íƒ€ì… ì•ˆì „ì„±ë„ í¬ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.